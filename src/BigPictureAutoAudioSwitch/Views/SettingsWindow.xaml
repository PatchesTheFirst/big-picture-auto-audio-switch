<Window x:Class="BigPictureAutoAudioSwitch.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Big Picture Auto Audio Switch - Settings" 
        Height="550" 
        Width="500"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource BackgroundBrush}"
        ResizeMode="NoResize">
    
    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="24" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="16" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="8" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title -->
        <StackPanel Grid.Row="0">
            <TextBlock Text="Settings" FontSize="24" FontWeight="Bold" />
            <TextBlock Text="Configure audio switching behavior" 
                       Foreground="{DynamicResource TextSecondaryBrush}" 
                       Margin="0,4,0,0" />
        </StackPanel>

        <!-- Audio Device Selection -->
        <StackPanel Grid.Row="2">
            <TextBlock Text="Audio Device for Big Picture Mode" FontWeight="SemiBold" />
            <TextBlock Text="Select the audio output device to switch to when Steam Big Picture is detected."
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       TextWrapping="Wrap"
                       Margin="0,4,0,8" />
            
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="8" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="8" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <ComboBox Grid.Column="0"
                          ItemsSource="{Binding Devices}"
                          SelectedItem="{Binding SelectedDevice}">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding FullName}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="{DynamicResource TextBrush}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource AncestorType=ComboBoxItem}}" Value="True">
                                                <Setter Property="Foreground" Value="{DynamicResource TextOnAccentBrush}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                
                <Button Grid.Column="2" 
                        Content="Refresh" 
                        Command="{Binding RefreshDevicesCommand}"
                        Style="{StaticResource PrimaryButton}" />
                
                <Button Grid.Column="4" 
                        Content="Test" 
                        Command="{Binding TestDeviceCommand}"
                        IsEnabled="{Binding SelectedDevice, Converter={StaticResource NullToBoolConverter}}"
                        Style="{StaticResource PrimaryButton}" />
            </Grid>
            
            <!-- Warning for missing device -->
            <Border Visibility="{Binding TargetDeviceMissing, Converter={StaticResource BooleanToVisibilityConverter}}"
                    Background="#44FFA500"
                    BorderBrush="#FFA500"
                    BorderThickness="1"
                    CornerRadius="4"
                    Padding="8"
                    Margin="0,8,0,0">
                <TextBlock Text="The previously configured audio device is no longer available. Please select a new device."
                           TextWrapping="Wrap"
                           Foreground="{DynamicResource TextBrush}" />
            </Border>
        </StackPanel>

        <!-- Options -->
        <StackPanel Grid.Row="4">
            <TextBlock Text="Options" FontWeight="SemiBold" Margin="0,0,0,8" />
            
            <CheckBox Content="Launch on Windows startup" 
                      IsChecked="{Binding LaunchOnStartup}"
                      Margin="0,0,0,8" />
            
            <CheckBox Content="Show notifications when audio switches" 
                      IsChecked="{Binding ShowNotifications}"
                      Margin="0,0,0,8" />
            
            <StackPanel Orientation="Horizontal" Margin="0,0,0,0">
                <CheckBox Content="Enable verbose logging (for troubleshooting)" 
                          IsChecked="{Binding VerboseLogging}"
                          VerticalAlignment="Center" />
                <Button Content="Open Logs Folder" 
                        Command="{Binding OpenLogsFolderCommand}"
                        Margin="16,0,0,0"
                        Style="{StaticResource PrimaryButton}" />
            </StackPanel>
            
            <TextBlock Text="Verbose logging auto-disables after 48 hours"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       FontSize="11"
                       Margin="20,2,0,0" />
        </StackPanel>

        <!-- Info -->
        <Border Grid.Row="6" 
                Background="{DynamicResource SurfaceBrush}" 
                CornerRadius="4" 
                Padding="12"
                Margin="0,16,0,0">
            <StackPanel>
                <TextBlock Text="How it works" FontWeight="SemiBold" />
                <TextBlock TextWrapping="Wrap" 
                           Foreground="{DynamicResource TextSecondaryBrush}"
                           Margin="0,4,0,0">
                    When Steam Big Picture Mode is detected, the app automatically switches 
                    your default audio output to the selected device. When Big Picture Mode 
                    closes, audio is restored to the previous device.
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- Save Button -->
        <StackPanel Grid.Row="8" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Save" 
                    Command="{Binding SaveCommand}"
                    IsEnabled="{Binding HasChanges}"
                    Style="{StaticResource PrimaryButton}"
                    Width="100" />
        </StackPanel>
    </Grid>
</Window>
